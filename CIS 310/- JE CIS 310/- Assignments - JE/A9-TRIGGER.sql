--JAKE ELLIS
--TRIGGER
--A9-#5


USE [CIS31008]
GO

ALTER TRIGGER A9_TRIGGER ON ASSIGNMENT
	AFTER INSERT, DELETE, UPDATE 
AS
	BEGIN 
	
DECLARE @EMP_TOTAL_HOURS FLOAT
UPDATE EMPLOYEE
SET EMP_TOTAL_HOURS = 0

	END
	BEGIN
	
DECLARE JME CURSOR FOR
SELECT EMP_NUM, SUM(ASSIGN_HOURS) AS "SUM"
FROM ASSIGNMENT
GROUP BY EMP_NUM

	DECLARE @SUM FLOAT
	DECLARE @EMP_NUM FLOAT
	SELECT 'OLD VALUES'
	SELECT *
	FROM DELETED
	SELECT 'NEW VALUES'
	SELECT *
	FROM INSERTED


    
OPEN JME 
FETCH NEXT FROM JME INTO @EMP_NUM, @SUM
WHILE(@@FETCH_STATUS=0)
BEGIN
	PRINT(@EMP_NUM +''+ @SUM )
		UPDATE EMPLOYEE
		SET EMP_TOTAL_HOURS = @SUM
		WHERE EMP_NUM = @EMP_NUM
		FETCH NEXT FROM JME INTO @EMP_NUM, @SUM
    
    
    END
	CLOSE JME
	DEALLOCATE JME
END





